(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{74:function(e,n,a){"use strict";a.r(n),a.d(n,"frontMatter",(function(){return o})),a.d(n,"metadata",(function(){return p})),a.d(n,"toc",(function(){return b})),a.d(n,"default",(function(){return l}));var t=a(3),c=a(7),i=(a(0),a(88)),o={id:"asyncio-basic",title:"asyncio \u57fa\u7840\u6559\u7a0b","sidebar-title":"\u9644\u5f55 - asyncio \u57fa\u7840\u6559\u7a0b"},p={unversionedId:"appendixs/asyncio-basic",id:"appendixs/asyncio-basic",isDocsHomePage:!1,title:"asyncio \u57fa\u7840\u6559\u7a0b",description:"\u5728\u4f7f\u7528 Graia \u4e4b\u524d, \u8bf7\u52a1\u5fc5\u5148\u4e86\u89e3 Python \u57fa\u7840\u8bed\u6cd5. \u672c\u6587\u4ecb\u7ecd\u4e86 asyncio \u7684\u4f7f\u7528\u65b9\u6cd5. \u51ed\u8fd9\u4e9b\u4f60\u5c31\u53ef\u4ee5\u53bb\u6109\u5feb\u7684\u7528 Graia \u76f8\u5173\u7684\u4e1c\u897f\u4e86",source:"@site/docs\\appendixs\\asyncio-basic.md",slug:"/appendixs/asyncio-basic",permalink:"/docs/appendixs/asyncio-basic",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/appendixs/asyncio-basic.md",version:"current",sidebar:"docs",previous:{title:"Graia \u8fde\u63a5\u914d\u7f6e\u53c2\u6570",permalink:"/docs/guides/about-connection-config"}},b=[{value:"\u5bfc\u5165\u6a21\u5757",id:"\u5bfc\u5165\u6a21\u5757",children:[]},{value:"\u58f0\u660e\u5f02\u6b65\u51fd\u6570 / \u65b9\u6cd5",id:"\u58f0\u660e\u5f02\u6b65\u51fd\u6570--\u65b9\u6cd5",children:[]},{value:"\u83b7\u53d6\u4e8b\u4ef6\u5faa\u73af (Event Loop) \u5bf9\u8c61",id:"\u83b7\u53d6\u4e8b\u4ef6\u5faa\u73af-event-loop-\u5bf9\u8c61",children:[]},{value:"\u8fd0\u884c\u5f02\u6b65\u51fd\u6570 / \u65b9\u6cd5",id:"\u8fd0\u884c\u5f02\u6b65\u51fd\u6570--\u65b9\u6cd5",children:[]},{value:"\u5c06\u5f02\u6b65\u6267\u884c\u4e22\u5230\u540e\u53f0",id:"\u5c06\u5f02\u6b65\u6267\u884c\u4e22\u5230\u540e\u53f0",children:[]}],r={toc:b};function l(e){var n=e.components,a=Object(c.a)(e,["components"]);return Object(i.b)("wrapper",Object(t.a)({},r,a,{components:n,mdxType:"MDXLayout"}),Object(i.b)("p",null,"\u5728\u4f7f\u7528 Graia \u4e4b\u524d, \u8bf7\u52a1\u5fc5\u5148\u4e86\u89e3 Python \u57fa\u7840\u8bed\u6cd5. \u672c\u6587\u4ecb\u7ecd\u4e86 asyncio \u7684\u4f7f\u7528\u65b9\u6cd5. \u51ed\u8fd9\u4e9b\u4f60\u5c31\u53ef\u4ee5\u53bb\u6109\u5feb\u7684\u7528 Graia \u76f8\u5173\u7684\u4e1c\u897f\u4e86"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"asyncio")," \u5728 Python 3.4 \u5373\u6210\u4e3a\u6807\u51c6\u5e93, \u6211\u4eec\u5728\u8fd9\u91cc\u4f7f\u7528 3.8 \u7248\u672c."),Object(i.b)("h2",{id:"\u5bfc\u5165\u6a21\u5757"},"\u5bfc\u5165\u6a21\u5757"),Object(i.b)("p",null,"\u975e\u5e38\u7b80\u5355\u7684\u64cd\u4f5c, \u4f7f\u7528 ",Object(i.b)("inlineCode",{parentName:"p"},"import")," \u5373\u53ef."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-py"},"import asyncio\n")),Object(i.b)("h2",{id:"\u58f0\u660e\u5f02\u6b65\u51fd\u6570--\u65b9\u6cd5"},"\u58f0\u660e\u5f02\u6b65\u51fd\u6570 / \u65b9\u6cd5"),Object(i.b)("p",null,"\u540c\u6837\u975e\u5e38\u7b80\u5355, \u5728 ",Object(i.b)("inlineCode",{parentName:"p"},"3.5")," \u7248\u672c\u4e2d\u5c31\u6709 ",Object(i.b)("inlineCode",{parentName:"p"},"async")," \u548c ",Object(i.b)("inlineCode",{parentName:"p"},"await")," \u4e24\u4e2a\u5173\u952e\u5b57.",Object(i.b)("br",{parentName:"p"}),"\n",Object(i.b)("inlineCode",{parentName:"p"},"await")," \u5173\u952e\u5b57\u7528\u4e8e\u5728\u4e00\u4e2a\u5f02\u6b65\u6267\u884c\u5185\u8c03\u7528\u5176\u4ed6\u7684\u5f02\u6b65\u51fd\u6570/\u65b9\u6cd5\u5e76\u83b7\u53d6\u5176\u8fd4\u56de\u503c."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-py"},"async def func1(arg1, arg2):\n    return arg1 + arg2\n\nasync def func2():\n    func1_return = await func1(1, 2)\n    return func1_return\n")),Object(i.b)("p",null,"\u7528\u5728\u7c7b\u7684\u58f0\u660e\u91cc\u4e5f\u4e00\u6837, \u4f46\u4e0d\u8981\u7528\u6765\u58f0\u660e\u9b54\u6cd5\u65b9\u6cd5, \u4e5f\u4e0d\u8981\u7528\u4e8e ",Object(i.b)("inlineCode",{parentName:"p"},"property"),"."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-py"},"class Example:\n    async def method1(self, arg1):\n        return self.var1 + arg1 + 1\n    \n    async def method2(self):\n        return await self.method1(2)\n")),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",{parentName:"div",className:"admonition-heading"},Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",{parentName:"h5",className:"admonition-icon"},Object(i.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(i.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(i.b)("div",{parentName:"div",className:"admonition-content"},Object(i.b)("p",{parentName:"div"},"\u4e5f\u4e0d\u662f\u975e\u5e38\u63a8\u8350\u4f7f\u7528 ",Object(i.b)("inlineCode",{parentName:"p"},"async_property"),"."))),Object(i.b)("h2",{id:"\u83b7\u53d6\u4e8b\u4ef6\u5faa\u73af-event-loop-\u5bf9\u8c61"},"\u83b7\u53d6\u4e8b\u4ef6\u5faa\u73af (Event Loop) \u5bf9\u8c61"),Object(i.b)("p",null,"\u4e8b\u4ef6\u5faa\u73af\u7528\u6765\u5728 ",Object(i.b)("inlineCode",{parentName:"p"},"async")," \u4ee3\u7801\u5757\u5916\u90e8\u8fd0\u884c\u5f02\u6b65\u76f8\u5173\u7684\u4e1c\u897f. \u4e0e\u540c\u6b65\u76f8\u5bf9\u7684\u5c31\u662f\u5f02\u6b65, \u4f60\u8fd9\u6837\u7406\u89e3\u5c31\u597d."),Object(i.b)("p",null,"\u7b80\u5355\u8c03\u7528 ",Object(i.b)("inlineCode",{parentName:"p"},"asyncio.get_event_loop")," \u5373\u53ef\u83b7\u53d6\u4e8b\u4ef6\u5faa\u73af\u5bf9\u8c61."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-py"},"loop = asyncio.get_event_loop()\n")),Object(i.b)("h2",{id:"\u8fd0\u884c\u5f02\u6b65\u51fd\u6570--\u65b9\u6cd5"},"\u8fd0\u884c\u5f02\u6b65\u51fd\u6570 / \u65b9\u6cd5"),Object(i.b)("p",null,"\u4f7f\u7528 ",Object(i.b)("inlineCode",{parentName:"p"},"loop.run_until_complete")," \u6216\u8005 ",Object(i.b)("inlineCode",{parentName:"p"},"asyncio.run"),"(3.7 \u53ca\u4ee5\u4e0a) \u5373\u53ef."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-py"},"loop.run_until_complete(async_callable(arg1, arg2))\n\n# \u6548\u679c\u540c\n\nasyncio.run(async_callable(arg1, arg2))\n")),Object(i.b)("h2",{id:"\u5c06\u5f02\u6b65\u6267\u884c\u4e22\u5230\u540e\u53f0"},"\u5c06\u5f02\u6b65\u6267\u884c\u4e22\u5230\u540e\u53f0"),Object(i.b)("p",null,"\u672c\u65b9\u6cd5\u7ecf\u5e38\u88ab\u7528\u4e8e\u521b\u5efa\u540e\u53f0\u4efb\u52a1, \u4f46\u8bf7\u6ce8\u610f, \u539f\u5219\u4e0a\u8bf7\u4e0d\u8981\u6ee5\u7528."),Object(i.b)("p",null,"\u4f7f\u7528 ",Object(i.b)("inlineCode",{parentName:"p"},"loop.create_task")," \u65b9\u6cd5\u5373\u53ef, \u4f60\u53ef\u4ee5\u901a\u8fc7 ",Object(i.b)("inlineCode",{parentName:"p"},"await")," \u8fd9\u4e2a\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u5835\u585e\u5f53\u524d\u8fd0\u884c."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-py"},"async def main():\n    task = loop.create_task(background_exec(arg1, arg2))\n    # do sth\n    await task # \u7b49\u5f85\u8fd9\u4e2a\u4efb\u52a1\u5b8c\u6210\n")),Object(i.b)("p",null,'\u5c31\u8fd9\u6837, \u53ea\u8981\u4f60\u77e5\u9053 "\u5728\u53e6\u5916\u4e00\u4e2a\u5f02\u6b65\u51fd\u6570\u5185, \u53ea\u80fd\u7528 ',Object(i.b)("inlineCode",{parentName:"p"},"await"),' \u6267\u884c\u5176\u4ed6\u5f02\u6b65\u51fd\u6570", \u7136\u540e\u5176\u4ed6\u7684\u50cf ',Object(i.b)("inlineCode",{parentName:"p"},"async with"),", ",Object(i.b)("inlineCode",{parentName:"p"},"__await__")," \u4e4b\u7c7b\u7684\u81ea\u5df1\u53bb\u5b66\u5427, \u8bf7\u79fb\u6b65",Object(i.b)("a",{parentName:"p",href:"https://docs.python.org/zh-cn/3/library/asyncio.html"},"asyncio\u5b98\u65b9\u6587\u6863"),", \u4e0d\u7528\u4e00\u4e9b\u9ed1\u9b54\u6cd5(\u6211\u5b8c\u5168\u4e0d\u80fd\u7406\u89e3\u4e3a\u4ec0\u4e48\u6709\u4eba\u79f0 ",Object(i.b)("inlineCode",{parentName:"p"},"asyncio")," \u4e3a\u9ed1\u9b54\u6cd5, \u8fd9\u73a9\u610f\u57fa\u7840\u7684\u4e0d\u884c.), \u51ed\u8fd9\u4e9b\u4f60\u5c31\u53ef\u4ee5\u53bb\u6109\u5feb\u7684\u7528 Graia \u76f8\u5173\u7684\u4e1c\u897f\u4e86."))}l.isMDXComponent=!0}}]);